<!DOCTYPE html>
<html>
<head>
    <title>Ecommerce6 DApp</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.min.js" type="application/javascript"></script>
</head>
<body>
    <h1>Ecommerce6 DApp</h1>
    <button id="list-item-button">List Item</button>
    <button id="buy-item-button">Buy Item</button>

    <script type="text/javascript">
        const contractABI = [
            // Your contract ABI here
        ];

        const contractAddress = "0xYourContractAddress";

        async function connectToMetamask() {
            if (window.ethereum) {
                try {
                    await window.ethereum.request({ method: "eth_requestAccounts" });
                    const provider = new ethers.providers.Web3Provider(window.ethereum);
                    const signer = provider.getSigner();
                    return signer;
                } catch (error) {
                    console.error("User denied account access");
                }
            } else {
                console.error("Metamask is not installed");
            }
        }

        async function listItem(id, name, category, cost, rating) {
            const signer = await connectToMetamask();
            const contract = new ethers.Contract(contractAddress, contractABI, signer);

            try {
                const tx = await contract.list(id, name, category, cost, rating);
                console.log("Transaction Hash:", tx.hash);

                // Wait for the transaction to be confirmed
                await tx.wait();
                console.log("Transaction Confirmed");
            } catch (error) {
                console.error("Error listing item:", error);
            }
        }

        async function buyItem(id) {
            const signer = await connectToMetamask();
            const contract = new ethers.Contract(contractAddress, contractABI, signer);

            try {
                const item = await contract.items(id);
                const tx = await contract.buy(id, { value: item.cost });
                console.log("Transaction Hash:", tx.hash);

                // Wait for the transaction to be confirmed
                await tx.wait();
                console.log("Transaction Confirmed");
            } catch (error) {
                console.error("Error buying item:", error);
            }
        }

        document.getElementById('list-item-button').addEventListener('click', () => {
            const id = 1;
            const name = "Item Name";
            const category = "Category";
            const cost = ethers.utils.parseEther("0.01");
            const rating = 5;

            listItem(id, name, category, cost, rating);
        });

        document.getElementById('buy-item-button').addEventListener('click', () => {
            const id = 1;

            buyItem(id);
        });
    </script>
</body>
</html>
